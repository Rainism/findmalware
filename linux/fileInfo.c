#include "fileInfo.h"
#include <sys/stat.h>
#include <sys/types.h>
#include <time.h>  
#include <string.h>
#include <stdio.h>
#include <malloc.h>
#include <stdlib.h>

///
unsigned long get_file_size(const char *path){
	unsigned long filesize = -1;
	struct stat statbuff;
	if(stat(path, &statbuff) < 0){
	return filesize;
	}else{
		filesize = statbuff.st_size;
	}
	return filesize;
}

int getFileTimeInfo(char *file,char *access_time,char *create_time,char *modify_time){
	struct stat statbuf;
	FILE *fp = fopen (file, "rb");
	if (fp == NULL) {
		fprintf (stderr, "fopen  failed\n");
		return 0;
	}
	stat(file, &statbuf);
	strncpy(create_time, ctime(&statbuf.st_ctime), strlen(ctime(&statbuf.st_ctime))-1);
	create_time[strlen(ctime(&statbuf.st_ctime))-1] = '\0';

	strncpy(access_time, ctime(&statbuf.st_atime), strlen(ctime(&statbuf.st_atime))-1);
	access_time[strlen(ctime(&statbuf.st_atime))-1] = '\0';

	strncpy(modify_time, ctime(&statbuf.st_mtime), strlen(ctime(&statbuf.st_mtime))-1);
	modify_time[strlen(ctime(&statbuf.st_mtime))-1] = '\0';
	fclose(fp);
	return 1;
}

int getRunTime(char *file){
	struct stat statbuf;
	int runtime=0;
	char timecha[64]={""};
	FILE *fp = fopen (file, "rb");
	if (fp == NULL) {
		fprintf (stderr, "fopen  failed\n");
		return 0;
	}
	stat(file, &statbuf);

	time_t rawtime;
	struct tm * timeinfo;
	time ( &rawtime );

	timeinfo = localtime ( &rawtime );
	time_t local_time=mktime(timeinfo );

	runtime=(int)difftime(local_time,statbuf.st_atime);
	fclose(fp);
	return runtime;
}

int getOS_Version(char *version){
	FILE *op;
	op=fopen("/proc/version","r");
	char lbuf[260];
	if (op==NULL){
		return 0;
	}
	fgets(lbuf,260,op);
	//printf("%s\n",lbuf);
	strncpy(version,lbuf,strlen(lbuf)-1);
	fclose(op);
	return 1;
}
