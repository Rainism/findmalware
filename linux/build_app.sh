#!/bin/sh
CURPATH=`pwd`
OPENSSL_TAR=${CURPATH}/buildtars/openssl-1.0.1f.tar.gz
LIBCURL_TAR=${CURPATH}/buildtars/curl-7.26.0.tar.gz
OPENSSL=${CURPATH}/openssl-1.0.1f
OPENSSLTARGET=${CURPATH}/openssl
PLATFORM_BIT=`getconf LONG_BIT`
QT_CONF_PATH=${CURPATH}/qmake/${PLATFORM_BIT}bit
QT_QMAKE=${CURPATH}/qmake/${PLATFORM_BIT}bit/qmake
LIBCURL=${CURPATH}/curl
LIBCURL_BUILD=${CURPATH}/curl-7.26.0

pre_build()
{
	mkdir -p _tmp
	if [ ! -f ${QT_CONF_PATH}/qt.conf ]; then
		mv ${QT_CONF_PATH}/qt.conf _tmp
	fi
	
QT_CONF_DATA="
[Paths]
Prefix=${QT_CONF_PATH}
"
	echo "${QT_CONF_DATA}" >  ${QT_CONF_PATH}/qt.conf
  cd ${CURPATH}
  chmod +x ${QT_QMAKE}
  ${QT_QMAKE} ${CURPATH}/findmalware.pro
  gmake
  mv ./*.o _tmp
  echo "End Build"
  md5sum -b ${CURPATH}/findmalware |  awk  '{print $1}' > ${CURPATH}/findmalware.md5sum
}

dep_build()
{
	pre_build
}

if [ ! -z $1 ]; then
  if [ $1 == 'clean' ]; then
    dep_clean
  elif [ $1 == 'build' ]; then
    dep_build
	exit 0
  fi
else
  dep_build
  exit 0
fi
